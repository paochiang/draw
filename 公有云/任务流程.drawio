<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36" version="28.1.2" pages="2">
  <diagram name="离线任务创建和提交" id="q-FKr38_cjb9bAnMw6bk">
    <mxGraphModel dx="1554" dy="763" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="2ayJp5on0NI8x-PA82Mp-1" value="job-notify" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" vertex="1" parent="1">
          <mxGeometry x="120" y="80" width="100" height="640" as="geometry" />
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-3" value="" style="html=1;points=[[0,0,0,0,5],[0,1,0,0,-5],[1,0,0,0,5],[1,1,0,0,-5]];perimeter=orthogonalPerimeter;outlineConnect=0;targetShapes=umlLifeline;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" vertex="1" parent="2ayJp5on0NI8x-PA82Mp-1">
          <mxGeometry x="50" y="220" width="10" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-4" value="校验项目id不为空&lt;div&gt;校验挂载数据集、模型小于等于3个&lt;/div&gt;&lt;div&gt;校验不能挂载相同数据集、模型&lt;/div&gt;&lt;div&gt;校验任务名不为空&lt;/div&gt;&lt;div&gt;验证如果多个角色，只能选择一种实例规格&lt;/div&gt;&lt;div&gt;请求来源角色校验&lt;/div&gt;&lt;div&gt;校验来源角色只能是普通用户&lt;/div&gt;&lt;div&gt;分布式锁校验，防止并发问题&lt;/div&gt;&lt;div&gt;项目权限校验&lt;/div&gt;&lt;div&gt;持久化存储配额校验&lt;/div&gt;&lt;div&gt;校验任务是否重名&lt;/div&gt;&lt;div&gt;校验等待中任务数量是否达上限&lt;/div&gt;" style="html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;edgeStyle=orthogonalEdgeStyle;curved=0;rounded=0;fontSize=12;startSize=8;endSize=8;" edge="1" target="2ayJp5on0NI8x-PA82Mp-3" parent="2ayJp5on0NI8x-PA82Mp-1">
          <mxGeometry x="0.0118" relative="1" as="geometry">
            <mxPoint x="55" y="200" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="85" y="230" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-5" value="" style="html=1;points=[[0,0,0,0,5],[0,1,0,0,-5],[1,0,0,0,5],[1,1,0,0,-5]];perimeter=orthogonalPerimeter;outlineConnect=0;targetShapes=umlLifeline;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" vertex="1" parent="2ayJp5on0NI8x-PA82Mp-1">
          <mxGeometry x="50" y="340" width="10" height="190" as="geometry" />
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-6" value="创建任务GenerateJobFromPrerequisite" style="html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;edgeStyle=orthogonalEdgeStyle;curved=0;rounded=0;fontSize=12;startSize=8;endSize=8;" edge="1" target="2ayJp5on0NI8x-PA82Mp-5" parent="2ayJp5on0NI8x-PA82Mp-1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="55" y="320" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="85" y="350" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-7" value="" style="html=1;points=[[0,0,0,0,5],[0,1,0,0,-5],[1,0,0,0,5],[1,1,0,0,-5]];perimeter=orthogonalPerimeter;outlineConnect=0;targetShapes=umlLifeline;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" vertex="1" parent="2ayJp5on0NI8x-PA82Mp-1">
          <mxGeometry x="60" y="450" width="10" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-8" value="验证镜像、数据集、模型状态以及权限&lt;div&gt;验证数据集状态以及权限&lt;/div&gt;&lt;div&gt;统计资源信息&amp;amp;构造配额校验和集群校验输入项&lt;/div&gt;&lt;div&gt;校验实例规格可用区&lt;/div&gt;&lt;div&gt;配额校验QuotaCheckJobV2&lt;/div&gt;&lt;div&gt;创建结果集&lt;/div&gt;&lt;div&gt;任务记录写入mysql&lt;/div&gt;&lt;div&gt;进入配额队列(sch_quota_queue表写入job信息)&lt;br&gt;&lt;div&gt;记录任务状态(写入pro_job_status表)&lt;/div&gt;&lt;/div&gt;" style="html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;edgeStyle=orthogonalEdgeStyle;curved=0;rounded=0;fontSize=12;startSize=8;endSize=8;" edge="1" target="2ayJp5on0NI8x-PA82Mp-7" parent="2ayJp5on0NI8x-PA82Mp-1">
          <mxGeometry x="0.0118" relative="1" as="geometry">
            <mxPoint x="65" y="430" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="95" y="460" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-9" value="" style="html=1;points=[[0,0,0,0,5],[0,1,0,0,-5],[1,0,0,0,5],[1,1,0,0,-5]];perimeter=orthogonalPerimeter;outlineConnect=0;targetShapes=umlLifeline;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" vertex="1" parent="2ayJp5on0NI8x-PA82Mp-1">
          <mxGeometry x="50" y="580" width="10" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-10" value="记录操作日志" style="html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;edgeStyle=orthogonalEdgeStyle;curved=0;rounded=0;fontSize=12;startSize=8;endSize=8;" edge="1" target="2ayJp5on0NI8x-PA82Mp-9" parent="2ayJp5on0NI8x-PA82Mp-1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="55" y="560" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="85" y="590" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-2" value="NewJob" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;fontSize=12;startSize=8;endSize=8;" edge="1" parent="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="80" y="160" as="sourcePoint" />
            <mxPoint x="160" y="160" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-11" value="job-sync" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" vertex="1" parent="1">
          <mxGeometry x="80" y="760" width="100" height="650" as="geometry" />
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-12" value="" style="html=1;points=[[0,0,0,0,5],[0,1,0,0,-5],[1,0,0,0,5],[1,1,0,0,-5]];perimeter=orthogonalPerimeter;outlineConnect=0;targetShapes=umlLifeline;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" vertex="1" parent="2ayJp5on0NI8x-PA82Mp-11">
          <mxGeometry x="50" y="140" width="10" height="510" as="geometry" />
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-13" value="从sch_quota_queue表中查询出所有没计算过分数的任务（新进任务，is_scored = 0）&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;edgeStyle=orthogonalEdgeStyle;curved=0;rounded=0;fontSize=12;startSize=8;endSize=8;" edge="1" target="2ayJp5on0NI8x-PA82Mp-12" parent="2ayJp5on0NI8x-PA82Mp-11">
          <mxGeometry x="0.0118" relative="1" as="geometry">
            <mxPoint x="55" y="120" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="85" y="150" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-14" value="" style="html=1;points=[[0,0,0,0,5],[0,1,0,0,-5],[1,0,0,0,5],[1,1,0,0,-5]];perimeter=orthogonalPerimeter;outlineConnect=0;targetShapes=umlLifeline;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" vertex="1" parent="2ayJp5on0NI8x-PA82Mp-11">
          <mxGeometry x="60" y="250" width="10" height="50" as="geometry" />
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-15" value="检查任务状态&lt;div&gt;根据任务等待时间，计算时间等待分数&lt;/div&gt;&lt;div&gt;根据个人配额使用量，计算配额分数&lt;/div&gt;&lt;div&gt;如果配额无限制，直接进入aiflowbroker任务池JobSubmitAiflow&lt;/div&gt;&lt;div&gt;计算总分：时间等待分数+配额分数+优先级分数&lt;/div&gt;&lt;div&gt;更新得分到&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212)); color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;sch_quota_queue表&lt;/span&gt;&lt;/div&gt;" style="html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;edgeStyle=orthogonalEdgeStyle;curved=0;rounded=0;fontSize=12;startSize=8;endSize=8;" edge="1" target="2ayJp5on0NI8x-PA82Mp-14" parent="2ayJp5on0NI8x-PA82Mp-11">
          <mxGeometry x="0.0118" relative="1" as="geometry">
            <mxPoint x="65" y="230" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="95" y="260" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-23" value="" style="html=1;points=[[0,0,0,0,5],[0,1,0,0,-5],[1,0,0,0,5],[1,1,0,0,-5]];perimeter=orthogonalPerimeter;outlineConnect=0;targetShapes=umlLifeline;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" vertex="1" parent="2ayJp5on0NI8x-PA82Mp-11">
          <mxGeometry x="60" y="360" width="10" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-24" value="&lt;div&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;从&lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;sch_quota_queue表中查询所有计算过分数的空间(&lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;is_scored = 1&lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;" style="html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;edgeStyle=orthogonalEdgeStyle;curved=0;rounded=0;fontSize=12;startSize=8;endSize=8;" edge="1" target="2ayJp5on0NI8x-PA82Mp-23" parent="2ayJp5on0NI8x-PA82Mp-11">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="65" y="340" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="95" y="370" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-16" value="" style="html=1;points=[[0,0,0,0,5],[0,1,0,0,-5],[1,0,0,0,5],[1,1,0,0,-5]];perimeter=orthogonalPerimeter;outlineConnect=0;targetShapes=umlLifeline;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" vertex="1" parent="2ayJp5on0NI8x-PA82Mp-11">
          <mxGeometry x="60" y="459" width="10" height="170" as="geometry" />
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-17" value="如果分数计算超过了15轮，空间内的所有有分数的任务重新计算并更新分数&lt;div&gt;查询该空间下所有有分数任务，按照分数降序排列&lt;/div&gt;" style="html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;edgeStyle=orthogonalEdgeStyle;curved=0;rounded=0;fontSize=12;startSize=8;endSize=8;" edge="1" target="2ayJp5on0NI8x-PA82Mp-16" parent="2ayJp5on0NI8x-PA82Mp-11">
          <mxGeometry x="0.0118" relative="1" as="geometry">
            <mxPoint x="65" y="439" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="95" y="469" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-18" value="" style="html=1;points=[[0,0,0,0,5],[0,1,0,0,-5],[1,0,0,0,5],[1,1,0,0,-5]];perimeter=orthogonalPerimeter;outlineConnect=0;targetShapes=umlLifeline;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" vertex="1" parent="2ayJp5on0NI8x-PA82Mp-11">
          <mxGeometry x="70" y="579" width="10" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-19" value="如果用户之前已经有任务因为个人配额不足而等待，则直接略过&lt;div&gt;检查任务状态&lt;/div&gt;&lt;div&gt;个人配额校验QuotaCheckJobV2（cpu、memory、临时存储、gpu、vgpu）&lt;/div&gt;&lt;div&gt;个人配额不足，则让其他人任务先行，跳过&lt;/div&gt;&lt;div&gt;空间配额校验SpaceQuotaCheckJob&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212)); color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;（cpu、memory、临时存储、gpu、vgpu）&lt;/span&gt;&lt;/div&gt;&lt;div&gt;进入aiflowbroker任务池JobSubmitAiflow&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212)); color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;空间内的所有有分数的任务重新计算并更新分数&lt;/span&gt;&lt;/div&gt;" style="html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;edgeStyle=orthogonalEdgeStyle;curved=0;rounded=0;fontSize=12;startSize=8;endSize=8;" edge="1" target="2ayJp5on0NI8x-PA82Mp-18" parent="2ayJp5on0NI8x-PA82Mp-11">
          <mxGeometry x="0.0118" relative="1" as="geometry">
            <mxPoint x="75" y="559" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="105" y="589" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-21" value="遍历空间" style="shape=umlFrame;whiteSpace=wrap;html=1;pointerEvents=0;" vertex="1" parent="2ayJp5on0NI8x-PA82Mp-11">
          <mxGeometry x="-10" y="409" width="600" height="230" as="geometry" />
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-22" value="遍历任务" style="shape=umlFrame;whiteSpace=wrap;html=1;pointerEvents=0;" vertex="1" parent="2ayJp5on0NI8x-PA82Mp-11">
          <mxGeometry y="489" width="550" height="140" as="geometry" />
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-20" value="遍历任务" style="shape=umlFrame;whiteSpace=wrap;html=1;pointerEvents=0;" vertex="1" parent="1">
          <mxGeometry x="70" y="930" width="560" height="150" as="geometry" />
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-25" value="job-sync" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" vertex="1" parent="1">
          <mxGeometry x="710" y="760" width="100" height="530" as="geometry" />
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-26" value="" style="html=1;points=[[0,0,0,0,5],[0,1,0,0,-5],[1,0,0,0,5],[1,1,0,0,-5]];perimeter=orthogonalPerimeter;outlineConnect=0;targetShapes=umlLifeline;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" vertex="1" parent="2ayJp5on0NI8x-PA82Mp-25">
          <mxGeometry x="50" y="140" width="10" height="50" as="geometry" />
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-27" value="&lt;div&gt;记录任务状态检查或创建(pro_job_status表)&lt;/div&gt;&lt;div&gt;检查任务、数据，构建aiblow-broker请求&lt;/div&gt;" style="html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;edgeStyle=orthogonalEdgeStyle;curved=0;rounded=0;fontSize=12;startSize=8;endSize=8;" edge="1" parent="2ayJp5on0NI8x-PA82Mp-25" target="2ayJp5on0NI8x-PA82Mp-26">
          <mxGeometry x="0.0118" relative="1" as="geometry">
            <mxPoint x="55" y="120" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="85" y="150" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-42" value="" style="html=1;points=[[0,0,0,0,5],[0,1,0,0,-5],[1,0,0,0,5],[1,1,0,0,-5]];perimeter=orthogonalPerimeter;outlineConnect=0;targetShapes=umlLifeline;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" vertex="1" parent="2ayJp5on0NI8x-PA82Mp-25">
          <mxGeometry x="50" y="300" width="10" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-43" value="从sch_quota_queue表删除任务&lt;div&gt;pro_job_instance表插入数据&lt;/div&gt;" style="html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;edgeStyle=orthogonalEdgeStyle;curved=0;rounded=0;fontSize=12;startSize=8;endSize=8;" edge="1" target="2ayJp5on0NI8x-PA82Mp-42" parent="2ayJp5on0NI8x-PA82Mp-25">
          <mxGeometry x="0.0118" relative="1" as="geometry">
            <mxPoint x="55" y="280" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="85" y="310" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-44" value="" style="html=1;points=[[0,0,0,0,5],[0,1,0,0,-5],[1,0,0,0,5],[1,1,0,0,-5]];perimeter=orthogonalPerimeter;outlineConnect=0;targetShapes=umlLifeline;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" vertex="1" parent="2ayJp5on0NI8x-PA82Mp-25">
          <mxGeometry x="50" y="460" width="10" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-45" value="&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212)); color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;记录任务状态(写入pro_job_status表)&lt;/span&gt;&lt;/div&gt;" style="html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;edgeStyle=orthogonalEdgeStyle;curved=0;rounded=0;fontSize=12;startSize=8;endSize=8;" edge="1" parent="2ayJp5on0NI8x-PA82Mp-25" target="2ayJp5on0NI8x-PA82Mp-44">
          <mxGeometry x="0.0118" relative="1" as="geometry">
            <mxPoint x="55" y="440" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="85" y="470" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-38" value="gemini-bill-rpc" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" vertex="1" parent="1">
          <mxGeometry x="1000" y="760" width="100" height="280" as="geometry" />
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-41" value="CreateBillTask" style="html=1;verticalAlign=bottom;startArrow=oval;startFill=1;endArrow=block;startSize=8;curved=0;rounded=0;fontSize=12;" edge="1" parent="1" target="2ayJp5on0NI8x-PA82Mp-38">
          <mxGeometry x="-0.0018" width="60" relative="1" as="geometry">
            <mxPoint x="767" y="1004.5" as="sourcePoint" />
            <mxPoint x="827" y="1004.5" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-46" value="aiflow-broker" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" vertex="1" parent="1">
          <mxGeometry x="1160" y="760" width="100" height="520" as="geometry" />
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-50" value="" style="html=1;points=[[0,0,0,0,5],[0,1,0,0,-5],[1,0,0,0,5],[1,1,0,0,-5]];perimeter=orthogonalPerimeter;outlineConnect=0;targetShapes=umlLifeline;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" vertex="1" parent="2ayJp5on0NI8x-PA82Mp-46">
          <mxGeometry x="50" y="419" width="10" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-51" value="参数校验&lt;div&gt;检查提交的job是否在job_pool里重复&lt;/div&gt;&lt;div&gt;往job_pool表插入任务，并在job_pool_submit_info里记录任务提交信息&lt;/div&gt;" style="html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;edgeStyle=orthogonalEdgeStyle;curved=0;rounded=0;fontSize=12;startSize=8;endSize=8;" edge="1" target="2ayJp5on0NI8x-PA82Mp-50" parent="2ayJp5on0NI8x-PA82Mp-46">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="55" y="399" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="85" y="429" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-49" value="JobSubmit" style="html=1;verticalAlign=bottom;startArrow=oval;startFill=1;endArrow=block;startSize=8;curved=0;rounded=0;fontSize=12;" edge="1" parent="1" target="2ayJp5on0NI8x-PA82Mp-46">
          <mxGeometry x="-0.0033" width="60" relative="1" as="geometry">
            <mxPoint x="760" y="1130" as="sourcePoint" />
            <mxPoint x="1043" y="1130.5" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-53" value="&lt;span style=&quot;font-size: 12px; text-align: left; background-color: rgb(255, 255, 255);&quot;&gt;JobSubmitAiflow流程&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=16;" vertex="1" parent="1">
          <mxGeometry x="700" y="720" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2ayJp5on0NI8x-PA82Mp-54" value="定时任务(5s)" style="shape=umlFrame;whiteSpace=wrap;html=1;pointerEvents=0;" vertex="1" parent="1">
          <mxGeometry x="40" y="840" width="650" height="570" as="geometry" />
        </mxCell>
        <mxCell id="gNt-T2uzj1xn7AGjJJt7-1" value="&lt;span style=&quot;font-size: 12px; text-align: left; background-color: rgb(255, 255, 255);&quot;&gt;配额队列流程&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=16;" vertex="1" parent="1">
          <mxGeometry x="40" y="720" width="100" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram name="离线任务调度和更新" id="KDuRLmohUwIqfBv5t3YJ">
    <mxGraphModel dx="1554" dy="763" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="uxq78JOp1_QEmdOXQwrp-0" />
        <mxCell id="uxq78JOp1_QEmdOXQwrp-1" parent="uxq78JOp1_QEmdOXQwrp-0" />
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
